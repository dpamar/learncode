//Constants
var initialHTML = '<div style="background-color:#FF0000; width:500; height:500;" onmousedown="StartRecordStroke();" onmousemove="RecordStroke(event);" onmouseup="StopRecordStroke();">&nbsp;</div>';
var strokeDelay = 500;

var data = [[[[0.08778077268643303, -0.45718778077268585],[-0.017531506477431333, -0.45718778077268585],[-0.1202978257413429, -0.4365703863282071],[-0.21176212302535866, -0.38583249578129497],[-0.2981899031975784, -0.3256772807250696],[-0.36859329495517446, -0.24761202691812645],[-0.42773894195103207, -0.16065812414519456],[-0.47345079004332036, -0.06585673078487717],[-0.5101646294868264, 0.032539230093610955],[-0.5274184000765137, 0.13620854767874052],[-0.5301437556154538, 0.24136988264960713],[-0.5183859759056456, 0.3446296654393832],[-0.4615419173245805, 0.43216877449931934],[-0.37976825384258034, 0.49840846569224856],[-0.29203429446585377, 0.555734874330416],[-0.19282496073624772, 0.588979055153454],[-0.08821285499075071, 0.5994159928122198],[0.016552128805059463, 0.5955082738133669],[0.11306848972764552, 0.5553162731013382],[0.19798479915829167, 0.49349987308701465],[0.27599338920283895, 0.42307360058710464],[0.3436255529332839, 0.34244341345059354],[0.39873277122346057, 0.2529077469237435],[0.43808601659166707, 0.15574218700260467],[0.4588056566056897, 0.05264486772758914],[0.4698562443845462, -0.052022955133185445],[0.45939204015114765, -0.1559338881190467],[0.39890923018566793, -0.24039894591496044],[0.33660191000187617, -0.32511179894328995],[0.25995426162777713, -0.3935073096161372],[0.15657850100737375, -0.4104093671839694],[0.05476190476190479, -0.4241689128481576]]],[[[-0.8494222436206069, 0.28033220991815155],[-0.779886235058372, 0.24478989284063157],[-0.7151779364570322, 0.20024460729297264],[-0.650520971977664, 0.15563246137309672],[-0.5872276046484544, 0.10907335224925459],[-0.5236822105215936, 0.06285852015699211],[-0.45913017867748984, 0.01807295742760972],[-0.3964770376119961, -0.029095786820685435],[-0.33602543884862734, -0.07926589682809179],[-0.27499285831870823, -0.12875177293343154],[-0.2147119318526285, -0.17911997056015858],[-0.1561555573978214, -0.23151251612498597],[-0.10172978982087029, -0.2881403489936491],[-0.049528258565521247, -0.3468670716559168],[0.002673272689827845, -0.4055937943181844],[0.05447417724365774, -0.46467383788985606],[0.10169403059545266, -0.5273905885027121],[0.14910733095131115, -0.5891651065892505],[0.14728712339769584, -0.514602187549134],[0.134779554911064, -0.43734743697802864],[0.12638420799229633, -0.3596727481826849],[0.11831969186326408, -0.2818262156772731],[0.11831969186326408, -0.20325250620613977],[0.11682911071448893, -0.12472842768893162],[0.11428743379874784, -0.04623934685408637],[0.11428743379874784, 0.03233436261704714],[0.11428743379874784, 0.11090807208818088],[0.11428743379874784, 0.1894817815593145],[0.11428743379874784, 0.2680554910304478],[0.11428743379874784, 0.34662920050158097],[0.11428743379874784, 0.4252029099727148],[0.10219065960520024, 0.4940418873375063]]],[[[-0.02156250000000004, -0.03946428571428551],[-0.14046938205520615, -0.04595560996493936],[-0.22231369504279747, -0.1261637018927076],[-0.24031250000000004, -0.24334471294582233],[-0.2070541368414822, -0.35598101203132104],[-0.12684360491928312, -0.4436322589217161],[-0.02712120502069355, -0.5103091668461059],[0.08389227706784966, -0.553782544736902],[0.2007172848712697, -0.5795182570304548],[0.32086601167282924, -0.5796428571428569],[0.4311885575515194, -0.5436509925506459],[0.5016168606591794, -0.44846270725306947],[0.5186160714285715, -0.33019430977166053],[0.5064407969297888, -0.21194814602906847],[0.437795238678396, -0.11489345296411003],[0.34885717958366125, -0.03526307487660042],[0.2498690052121506, 0.03275614364019395],[0.14412193569482692, 0.08927913969118836],[0.03448250534313388, 0.13844046188130435],[-0.0739542580753415, 0.19000405213539615],[-0.18471639689535727, 0.23651155875814311],[-0.298526353819708, 0.2745831893684743],[-0.4148486151616534, 0.30243373073737934],[-0.4790523947424297, 0.24585243611257643],[-0.3864313724089291, 0.175279022657937],[-0.2712553517635407, 0.14264785660492582],[-0.15127495017919124, 0.1391071428571431],[-0.03961416515944583, 0.17534802807215366],[0.05734165141260651, 0.2457832214152676],[0.15321849938674661, 0.3162971710606196],[0.26420660418228303, 0.3578571428571431],[0.38022321428571426, 0.3533928571428573]]],[[[-0.3318965517241377, -0.07262277951933194],[-0.4051479200693997, -0.13360026987717383],[-0.4123563218390802, -0.24229131733972498],[-0.37853472585018066, -0.3439787124119162],[-0.29405581761133126, -0.4123651923628245],[-0.1922249896377926, -0.45188534765364335],[-0.08433684832168997, -0.469174503657263],[0.02536377145165858, -0.469174503657263],[0.13279628747032618, -0.45293809492204773],[0.22488090082664852, -0.39492440119045524],[0.2936072734384279, -0.3094989053562176],[0.3175287356321841, -0.20453645275628007],[0.2672862847951289, -0.11696096704017678],[0.1747602488617097, -0.05870980050191089],[0.07352453329338449, -0.017310633689403023],[-0.032097045580286476, 0.007836990595610605],[0.028666485893512172, -0.004042825781333417],[0.13812389971848815, -0.009404388714734147],[0.246747308020869, -0.0017130396250278693],[0.3459026130675081, 0.04440154694186252],[0.43106133584319045, 0.11204393688913168],[0.45545977011494276, 0.21593151952267053],[0.3974705584204266, 0.3020394060992929],[0.3016404156790614, 0.35442220363433086],[0.1996006057368865, 0.39469409858171284],[0.09603601871434497, 0.4306066447514221],[-0.009322120303890576, 0.4611369627997022],[-0.11553146340633458, 0.4883515931376193],[-0.22411378895059053, 0.5035239633142587],[-0.3330787117857227, 0.5158854856666609],[-0.44264699788396267, 0.5193312434691737],[-0.5445402298850562, 0.49059561128526563]]],[[[0.03305785123966887, -1.0061479540415248],[-0.0029425803384558816, -0.9453541340336479],[-0.055172130256824416, -0.8931245841152795],[-0.09850308800378753, -0.8335999336060921],[-0.14006689480460993, -0.7725601383791806],[-0.18430486963946027, -0.7134103927446283],[-0.22736953592666403, -0.6534017959464692],[-0.2716877786373836, -0.5943108056655098],[-0.307757303290545, -0.5298707585317679],[-0.34945113883225576, -0.46898247537884663],[-0.38629631870017384, -0.40502945641427057],[-0.4167287282142563, -0.3379797538113602],[-0.44632154549640524, -0.27048910267627785],[-0.4676929082828222, -0.19980128744834322],[-0.49094698785693686, -0.12992541145105724],[-0.507014614518425, -0.057851740953534084],[-0.5123966942148765, 0.015479065984004947],[-0.5006866443641744, 0.08579728602378442],[-0.4458269128416134, 0.1344992733583781],[-0.3765348279183538, 0.1598673944243912],[-0.3041054739471678, 0.17435326521862832],[-0.23038011663264524, 0.175798333032287],[-0.15702293008212775, 0.1839346905865744],[-0.08315919223092849, 0.1839346905865744],[-0.009295454379729229, 0.1839346905865744],[0.06456828347147003, 0.1839346905865744],[0.1384320213226693, 0.1839346905865744],[0.21215989787158132, 0.18148166244840963],[0.2848845773239694, 0.16983543708905274],[0.3567752000312972, 0.15339777708273558],[0.42695155914931887, 0.13252659511255868],[0.48760330578512345, 0.10129006248740069]],[[0.1818181818181812, -0.1714372102398718],[0.1818181818181812, -0.14717701295914665],[0.1818181818181812, -0.12291681567842153],[0.1818181818181812, -0.09865661839769638],[0.1818181818181812, -0.07439642111697124],[0.1818181818181812, -0.05013622383624611],[0.1818181818181812, -0.02587602655552096],[0.1818181818181812, -0.001615829274795812],[0.1818181818181812, 0.02264436800592934],[0.1818181818181812, 0.04690456528665449],[0.1818181818181812, 0.07116476256737964],[0.1818181818181812, 0.09542495984810478],[0.1818181818181812, 0.11968515712882993],[0.1818181818181812, 0.14394535440955508],[0.1818181818181812, 0.16820555169028023],[0.1818181818181812, 0.19246574897100538],[0.1818181818181812, 0.21672594625173053],[0.1818181818181812, 0.24098614353245568],[0.1818181818181812, 0.2652463408131808],[0.1818181818181812, 0.289506538093906],[0.1818181818181812, 0.3137667353746311],[0.1818181818181812, 0.3380269326553562],[0.1818181818181812, 0.36228712993608136],[0.1818181818181812, 0.3865473272168065],[0.1818181818181812, 0.41080752449753166],[0.1818181818181812, 0.4350677217782568],[0.1818181818181812, 0.45932791905898196],[0.1818181818181812, 0.4835881163397071],[0.1818181818181812, 0.5078483136204323],[0.1818181818181812, 0.5321085109011574],[0.1818181818181812, 0.5563687081818826],[0.1818181818181812, 0.5806289054626075]]],[[[0.22569444444444553, -0.51799886621315],[0.11996906445439956, -0.51799886621315],[0.01424368446435359, -0.51799886621315],[-0.09148169552569241, -0.51799886621315],[-0.18977815109106383, -0.5101829268428112],[-0.2174328374595381, -0.4093051717968283],[-0.24185450588719018, -0.30674760807963547],[-0.2625759479003902, -0.20312252279892742],[-0.2757126551488698, -0.09857880416050407],[-0.2899733609308069, 0.005918391955629414],[-0.2981150793650782, 0.11083758294650448],[-0.22459412840846882, 0.10510460388677662],[-0.1286923166656856, 0.06236042218955018],[-0.029088293950744547, 0.027539702914428983],[0.07358910205054885, 0.002574807757980347],[0.17849614220442567, -0.00784737775287554],[0.2838012744296907, -0.014597505668932476],[0.38952665441973666, -0.014597505668932476],[0.491855197573544, 0.006451630606462766],[0.5740511671234942, 0.07128898889882568],[0.5930413832199557, 0.17393268105464643],[0.5672912128078916, 0.2737043088487405],[0.4944373082942776, 0.3493126917057254],[0.4080757783031511, 0.40888138227186566],[0.315310765563272, 0.4592275691501454],[0.21523953283633426, 0.493118263049422],[0.1145855440606442, 0.5250842444681395],[0.012422693094164244, 0.551511747171434],[-0.09181709832183188, 0.5689333296900729],[-0.19578306452039237, 0.5880653430628107],[-0.3012332367899997, 0.5908446712018158],[-0.4069586167800441, 0.5908446712018158]]],[[[0.5621800879532841, -0.870377045634777],[0.4364923322914199, -0.870377045634777],[0.3121539155524487, -0.8578820553184545],[0.18989654140100115, -0.8299443839824765],[0.07631187381686015, -0.7765542499444329],[-0.022479255024192697, -0.6997070980557827],[-0.11409354356018712, -0.6136838337017252],[-0.19353147277717822, -0.5171962010037591],[-0.2660689613764808, -0.4151390376949798],[-0.3127482219611699, -0.29844088623325715],[-0.3511470449073107, -0.17885354915525267],[-0.3769300214320435, -0.055945379827019776],[-0.38366915490856524, 0.06919994315652414],[-0.3888688630956667, 0.19473489829089186],[-0.3862426674020507, 0.3202053033520942],[-0.3343460504402821, 0.4330892686749666],[-0.24348145840346752, 0.5170019713966372],[-0.12331283579719576, 0.5492033739456423],[0.0015140413638456973, 0.5561963809386494],[0.1226946756703785, 0.5305919444532105],[0.2326561593806446, 0.4699946541661494],[0.3294576412422937, 0.3903174290482415],[0.40201041797396486, 0.2884536426248595],[0.4293129550861514, 0.16743856469579255],[0.37780500007874446, 0.05713597837879487],[0.27220566137301366, -0.008993229786242524],[0.14985373723098844, -0.03642832898555347],[0.02427685542691549, -0.038209213466944725],[-0.10141090023494903, -0.038209213466944725],[-0.22678757606976382, -0.036292253198189815],[-0.34384135041026204, 0.009207100120422598],[-0.43781991204671566, 0.08067190541417402]]],[[[-0.6784825870646769, -0.43159203980099314],[-0.6141207083127114, -0.4712356657441401],[-0.545538873263633, -0.5055265832686793],[-0.4755353151652384, -0.536651545575694],[-0.4035736935958087, -0.5630293326488249],[-0.3317194577003356, -0.5897002766213567],[-0.26007146820304705, -0.6169844140953172],[-0.18680522240128075, -0.6388827366142694],[-0.1116174118905482, -0.6539202987164159],[-0.035516765355607535, -0.6630821704997015],[0.04070458954899625, -0.6703980099502469],[0.11738141214470466, -0.6703980099502469],[0.19405823474041306, -0.6703980099502469],[0.25013785819265527, -0.623342644327504],[0.26760332652959046, -0.5494718952259584],[0.2692786069651738, -0.47289937181793795],[0.2679401148645063, -0.3963873251296665],[0.25143193855821905, -0.3215907340866382],[0.23279806659598312, -0.24752355302177959],[0.21226804514927522, -0.1736990462687421],[0.18522063385619436, -0.10204412195391784],[0.154593277315641, -0.0317590033134252],[0.1207794835394452, 0.03704799809524034],[0.08965076961905531, 0.10711701899263608],[0.06134345255019954, 0.17830811977522373],[0.030110693388715925, 0.2483087133507961],[-0.0016184015610477206, 0.3181127222402762],[-0.023448094870929304, 0.3914588793119351],[-0.047287414839056345, 0.46430062664988064],[-0.07917084582763811, 0.5339635822025409],[-0.10846244851305459, 0.6046162012605576],[-0.14863184079601943, 0.657960199004977]],[[-0.2157960199004978, 0.17288557213930522],[-0.19812288230724476, 0.17288557213930522],[-0.18044974471399172, 0.17288557213930522],[-0.16277660712073866, 0.17288557213930522],[-0.14510346952748565, 0.17288557213930522],[-0.1274303319342326, 0.17288557213930522],[-0.10975719434097957, 0.17288557213930522],[-0.09208405674772653, 0.17288557213930522],[-0.07441091915447348, 0.17288557213930522],[-0.056737781561220446, 0.17288557213930522],[-0.03906464396796741, 0.17288557213930522],[-0.021391506374714375, 0.17288557213930522],[-0.0037183687814613398, 0.17288557213930522],[0.013954768811791697, 0.17288557213930522],[0.03162790640504473, 0.17288557213930522],[0.04930104399829777, 0.17288557213930522],[0.06697418159155083, 0.17288557213930522],[0.08464731918480389, 0.17288557213930522],[0.10232045677805696, 0.17288557213930522],[0.11999359437131002, 0.17288557213930522],[0.13766673196456308, 0.17288557213930522],[0.15533986955781615, 0.17288557213930522],[0.1730130071510692, 0.17288557213930522],[0.19068614474432227, 0.17288557213930522],[0.20835928233757534, 0.17288557213930522],[0.2260324199308284, 0.17288557213930522],[0.24370555752408146, 0.17288557213930522],[0.2613786951173345, 0.17288557213930522],[0.2790518327105876, 0.17288557213930522],[0.2967249703038406, 0.17288557213930522],[0.31439810789709366, 0.17288557213930522],[0.3140547263681588, 0.18034825870646953]]],[[[0.12040175768989192, -0.6795982423101063],[-0.03220390713357685, -0.6795982423101063],[-0.18082841929077675, -0.6493527008925363],[-0.3216731523149919, -0.5918941206409978],[-0.4446829525758942, -0.5021182261034538],[-0.5401249829919654, -0.38510442758361674],[-0.583301946013812, -0.24242989829316863],[-0.49153474184456647, -0.14112204763289093],[-0.3552225159939578, -0.07287981250704358],[-0.2176992032919131, -0.007431219295420906],[-0.07968531184837113, 0.05697890012748433],[0.05663556271651677, 0.12555569724024332],[0.18820888933277227, 0.20269785701152798],[0.3053190130488521, 0.2996964750367424],[0.39447583176396606, 0.42212653521881194],[0.40680002795912373, 0.5640374787449738],[0.2711223891084582, 0.6307778735808852],[0.12213322581841782, 0.6607962048049292],[-0.028233921470397605, 0.6834256620293743],[-0.17966114653590676, 0.7023540651625629],[-0.32235697978778904, 0.6776430202122128],[-0.3536723163841824, 0.5339860455619885],[-0.3273035693850672, 0.3861827822101821],[-0.2389369360779508, 0.2619944474833918],[-0.14138561197536242, 0.14515209031811094],[-0.04008258216302568, 0.03109027764175422],[0.07019891113278746, -0.07383984019744654],[0.1876344871853433, -0.17076353017243567],[0.2905731245333195, -0.27939923878316375],[0.31547881717988285, -0.4227774566634576],[0.19152594103188125, -0.494413057124921],[0.03892027620841265, -0.494413057124921]]],[[[0.18704081632652958, -0.5772448979591835],[0.0483468741620415, -0.5772448979591835],[-0.09034706800244657, -0.5772448979591835],[-0.22329630149829754, -0.5425066750107718],[-0.34281975470423925, -0.47595575549984315],[-0.41940895898096453, -0.3614477860183502],[-0.43540816326530685, -0.2257646456637039],[-0.4089321585574282, -0.09365333987695737],[-0.2907345923710545, -0.02622448979591807],[-0.1530510534064926, -0.01602040816326511],[-0.017399623258254133, -0.027477183211027184],[0.09494666992435143, -0.10759973114884204],[0.1811362811462324, -0.21527239224911793],[0.259116659850561, -0.3288630781978329],[0.2788775510204071, -0.4647061438112876],[0.26867346938775416, -0.5145000524157861],[0.26867346938775416, -0.3758061102512982],[0.26867346938775416, -0.23711216808680957],[0.26867346938775416, -0.09841822592232141],[0.2780780187157206, 0.039607355499847244],[0.29769230411852166, 0.17690735331945312],[0.3185766339072806, 0.3140108238518526],[0.3298979591836724, 0.4517677844901371],[0.3401020408163258, 0.5892055468013839],[0.2962159959619826, 0.711539106078833],[0.1682736319471616, 0.7605601837617069],[0.032651421382621365, 0.7875660661938862],[-0.10539480278961305, 0.7953840030310454],[-0.24381613269021019, 0.8003061224489798],[-0.3825100748546979, 0.8003061224489798],[-0.5212040170191856, 0.8003061224489798],[-0.6598979591836742, 0.8003061224489798]]]];


var gestures = [];

var recordingGesture;
var recordingStroke;
var finalGesture;

function StartRecordGesture() {
    recordingGesture = new CGesture();
    setTimeout('StopReading(0)', strokeDelay);
    document.getElementById('drawingZone').innerHTML = initialHTML;
}

function StopRecordGesture() {
    finalGesture = recordingGesture;
    recordingGesture = null;
    NormalizeSize(finalGesture);
    NormalizeCenter(finalGesture);
    finalGesture.strokes = finalGesture.strokes.map(stroke => NormalizeSpacing(stroke));
    document.getElementById('drawingZone').innerHTML = initialHTML;
    Compare();
}

function StopReading(strokeCount) {
    if (recordingGesture && recordingGesture.strokes.length != strokeCount) setTimeout(`StopReading(${recordingGesture.strokes.length})`, strokeDelay);
    else StopRecordGesture();
}

function StartRecordStroke() {
    if (!recordingGesture) StartRecordGesture();
    recordingStroke = new CStroke();
    recordingGesture.strokes.push(recordingStroke);
}

function RecordStroke(e) {
    if (recordingStroke) {
        if (e.pageX)
            RecordPoint(e.pageX, e.pageY);
        else
            RecordPoint(event.x + document.body.scrollLeft, event.y + document.body.scrollTop);
    }
}

function StopRecordStroke() {
    recordingStroke = null;;
}

function RecordPoint(xPos, yPos) {
    recordingStroke.points.push(new CPoint2D(xPos, yPos));
    document.getElementById('drawingZone').innerHTML += "<div style='position:absolute; top:" + yPos + "; left:" + xPos + "; width:10; height:10; background-color:white;' onmousedown='StartRecordStroke();' onmousemove='RecordStroke(event);' onmouseup='StopRecordStroke();'></div>";
}

function Compare() {
    document.getElementById('results').innerHTML += BestMatch(finalGesture, gestures);
}

function loadData () {
	data.map(x => {
		var gesture = new CGesture();
		x.map(v=> {
			var vect = new CStroke();
			v.map(p => 
				vect.points.push(new CPoint2D(p[0], p[1])));
			gesture.strokes.push(vect);
		});
		gestures.push(gesture);
	});
}
