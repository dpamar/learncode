<html>
	<head>
		<title>Convex hull JS implementation</title>
		<script>
var canvas;
var ctx;
var anim = false;

function go(animation) {
	anim = animation;
	canvas = document.getElementById('canvas');
	ctx = canvas.getContext('2d');
	ctx.clearRect(0, 0, canvas.width, canvas.height);

	var size = parseInt(document.getElementById('pointsCount').value);
	init(size);
}


var points;
function init(size) {
	points = [];
	for(var i = 0; i<size; i++) {
		points.push([Math.floor(Math.random() * 1200), Math.floor(Math.random() * 800)]);
	}
	points.push([3,499]);
	points.push([333,499]);


	ctx.fillStyle = 'rgb(255,0,0)';
	points.map(x=>ctx.fillRect(...x.map(y=>y-1),3,3));
	ctx.strokeStyle = 'rgb(0,0,255, 0.6)';

	hull();
}

var firstPoint = null;
var lastPoint = null;
var hullPoints = null;
function addPoint(point) {
	hullPoints.push(point);
}

function hull() {

	hullPoints = [];

	//find lower point
	var max = 0;
	firstPoint = null;
	for(var i=0; i<points.length; i++) {
		if(max > points[i][1]) continue;
		if(max == points[i][1] && points[i][0] >= firstPoint[0]) continue;
		firstPoint = points[i];
		max = firstPoint[1];

	}
	addPoint(lastPoint = firstPoint);
	var nextPoint = null;
	var angle = 0;
	while(nextPoint == null || nextPoint[0] != firstPoint[0] || nextPoint[1] != firstPoint[1]) {
		var minAngle = 2*Math.PI;
		for(var i=0; i<points.length; i++) {
			var currentPoint = points[i];
			//Ignore current point
			if(currentPoint[0] == lastPoint[0] && currentPoint[1] == lastPoint[1]) continue;
			
			var currentAngle = Math.atan2(lastPoint[1]-currentPoint[1], currentPoint[0]-lastPoint[0]);
			if(currentAngle < 0) currentAngle += 2*Math.PI;

			if(currentAngle < angle) continue;
			if(currentAngle > minAngle) continue;
			if(currentAngle == angle) {
				var d1 = (lastPoint[0] - currentPoint[0])**2 + (lastPoint[1] - currentPoint[1])**2;
				var d2 = (lastPoint[0] - nextPoint[0])**2 + (lastPoint[1] - nextPoint[1])**2;
				if(d1 >= d2) continue;
			}
			minAngle = currentAngle;
			nextPoint = currentPoint;
		}
		addPoint(lastPoint = nextPoint);
		angle = minAngle;
		if(angle == 2*Math.PI) angle = 0;
	}

	drawPolygon();
}

function drawPolygon() {
	ctx.beginPath();
	ctx.moveTo(...hullPoints.shift());
	if(anim) setTimeout(nextLine, 400);
	else {
		while(hullPoints.length) {
			ctx.lineTo(...hullPoints.shift());
		}
		ctx.stroke();
	}
}
function nextLine() {
	if(hullPoints.length)
	{
		var p = hullPoints.shift();
		ctx.lineTo(...p);
		ctx.stroke();
		ctx.beginPath();
		ctx.moveTo(...p);
		setTimeout(nextLine, 400);
	}
}
		</script>
	</head>
	<body onload="go(true);">
		Enter number of random points :
		<input type="text" style="text-aling: right" value="100" id="pointsCount"/>
		<input type="button" value="Run" onclick="go(true)"/>
		<input type="button" value="Run (no animation)" onclick="go(false)"/>
		<br/>
		<canvas id="canvas" width="1200" height="800"></canvas>
	</body>
</html>
